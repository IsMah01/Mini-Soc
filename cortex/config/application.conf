# Cortex Configuration File

# Secret key
play.http.secret.key = "Super_Secret_Cortex_Key_987654321"

# Database Configuration (Elasticsearch)
search {
  index = cortex
  uri = "http://elasticsearch:9200"
  
  # Authentication
  user = "elastic"
  password = "changeme123"
  
  # SSL/TLS (disabled for local setup)
  ssl.enabled = false
  
  # Index settings
  settings {
    number_of_shards = 1
    number_of_replicas = 0
  }
}

# Authentication
auth {
  provider = [local]
  
  # Session timeout
  session {
    warning = 5m
    inactivity = 1h
  }
  
  # Local authentication
  local {
    defaultUserDomain = "cortex.local"
  }
}

# Analyzer Configuration
analyzer {
  # Chemin local des analyseurs
  paths = [
    "/opt/cortex/analyzers/analyzers"
  ]
  
  # URLs pour télécharger les définitions (inclut MISP-modules)
  urls = [
    "https://download.thehive-project.org/analyzers.json",
    "http://misp-modules:6666"
  ]
  
  # Fork join executor
  fork-join-executor {
    parallelism-min = 2
    parallelism-factor = 2.0
    parallelism-max = 4
  }
}

# Responder Configuration
responder {
  # Chemin local des responders
  paths = [
    "/opt/cortex/analyzers/responders"
  ]
  
  # URLs pour télécharger les définitions
  urls = [
    "https://download.thehive-project.org/responders.json"
  ]
  
  fork-join-executor {
    parallelism-min = 2
    parallelism-factor = 2.0
    parallelism-max = 4
  }
}

# Job directory
job {
  directory = /var/lib/cortex-jobs

  timeout = 30 minutes
}

# Cache for analyzers
cache {
  job = 10 minutes
  user = 5 minutes
  organization = 5 minutes
}

# Docker configuration for analyzers
docker {
  auto-update = false
}

# HTTP Server
http.port = 9001
play.server.http.port = 9001

# Max file upload size (100MB)
play.http.parser.maxDiskBuffer = 100MB
play.http.parser.maxMemoryBuffer = 100MB

# CORS Configuration
play.filters.cors {
  pathPrefixes = ["/"]
  allowedOrigins = ["*"]
  allowedHttpMethods = ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allowedHttpHeaders = ["Accept", "Content-Type", "Authorization"]
}

# Akka Configuration
akka {
  loggers = ["akka.event.slf4j.Slf4jLogger"]
  loglevel = "INFO"
  
  actor {
    default-dispatcher {
      fork-join-executor {
        parallelism-min = 2
        parallelism-factor = 2.0
        parallelism-max = 4
      }
    }
  }
}

# Stream Configuration
stream.longPolling {
  refresh = 1 minute
  cache = 15 minutes
  nextItemMaxWait = 500 ms
  globalMaxWait = 1 minute
}