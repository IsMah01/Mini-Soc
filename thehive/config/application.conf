# =============================================================================
# TheHive Configuration File - VERSION FINALE
# =============================================================================

play.http.secret.key = "${TH_SECRET}"

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
db {
  provider = janusgraph
  janusgraph {
    storage {
      backend = cql
      hostname = ["cassandra"]
      port = 9042
      cql {
        cluster-name = thp
        keyspace = thehive
        read-consistency-level = ONE
        write-consistency-level = ONE
      }
    }
    
    index.search {
      backend = elasticsearch
      hostname = ["elasticsearch"]
      port = 9200
      index-name = thehive
      
      elasticsearch {
        interface = REST_CLIENT
        bulk-chunk-size-limit-bytes = 10000000
        
        http {
          auth {
            type = BASIC
            basic {
              username = thehive_user
              password = changeme123
            }
          }
        }
      }
    }
  }
}

datastax-java-driver {
  advanced {
    session-leak {
      threshold = 10
    }
  }
}

# =============================================================================
# STORAGE CONFIGURATION (MinIO)
# =============================================================================
storage {
  provider = s3
  s3 {
    bucket = "thehive"
    endpoint = "http://minio:9000"
    accessKey = "admin"
    secretKey = "changeme123"
    region = "us-east-1"
  }
}

# =============================================================================
# CORTEX CONFIGURATION
# =============================================================================
# Cortex Configuration
cortex {
  servers = [
    {
      name = "local"
      url = "http://cortex:9001"
      auth {
        type = "bearer"
        key = "9zc1U2guwWpqI4gTi+iXRHPaN3aPsV+0"  # ← VOTRE API KEY ICI
      }
    }
  ]
}

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
application.baseUrl = "http://localhost:9000"

# =============================================================================
# AUTHENTICATION - CORRIGÉ
# =============================================================================
auth {
  providers = [
    {
      name = "session"
    }
    {
      name = "basic"
      realm = "thehive"
    }
    {
      name = "local"
      defaultUserDomain = "thehive.local"
    }
    {
      name = "key"
    }
  ]
  method.basic.mfa.enabled = false
}

# =============================================================================
# HTTP SERVER CONFIGURATION
# =============================================================================
http.port = 9000

play.server {
  http {
    address = "0.0.0.0"
    port = 9000
  }
}

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================
play.http.session {
  secure = false
  httpOnly = false
  sameSite = "lax"
  maxAge = 24h
  cookieName = "THEHIVE_SESSION"
  path = "/"
}

# =============================================================================
# UPLOAD LIMITS
# =============================================================================
play.http.parser.maxDiskBuffer = 100MB
play.http.parser.maxMemoryBuffer = 100MB

# =============================================================================
# FILTERS CONFIGURATION
# =============================================================================
play.filters.hosts.allowed = [
  "localhost:9000",
  "localhost", 
  "127.0.0.1:9000",
  "127.0.0.1",
  "0.0.0.0:9000",
  "0.0.0.0",
  "thehive:9000",
  "thehive",
  "."
]

# =============================================================================
# CORS CONFIGURATION
# =============================================================================
play.filters.enabled += "play.filters.cors.CORSFilter"
play.filters.cors {
  pathPrefixes = ["/"]
  allowedOrigins = ["*"]
  allowedHttpMethods = ["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"]
  allowedHttpHeaders = ["Accept", "Content-Type", "Authorization", "X-Auth-Token"]
  supportsCredentials = true
  preflightMaxAge = 3 days
}

# =============================================================================
# CSRF CONFIGURATION - DÉSACTIVÉ
# =============================================================================
play.filters.disabled += "play.filters.csrf.CSRFFilter"



# À ajouter dans application.conf de TheHive
misp {
  interval: 1 hour
  servers: [
    {
      name = "MISP"
      url = "https://misp-core"
      auth {
        type = key
        key = "VOTRE_CLE_API_MISP"  # Généré dans MISP
      }
      wsConfig {
        ssl {
          loose.acceptAnyCertificate = true  # Car certificat auto-signé
        }
      }
      caseTemplate = "misp-event"
      tags = ["misp", "threat-intel"]
      maxAttributes = 1000
      maxSize = 1 MiB
      purpose = ImportAndExport
    }
  ]
}